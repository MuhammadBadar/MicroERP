<div class="container-fluid page">
  <div class="d-flex page_box p-3 mt-2 header-sticky" position="sticky">
    <div>Task Activity Report</div>
  </div>
  <div class="page_content shadow p-3 position-relative">
    <div fxLayout="column">
      <div class="search-box">
        <i class="material-icons">search</i>
        <input type="text" class="search-input" placeholder="Search..." (keyup)="updateFilter($event)" name="FreeSearch"
          #freeSearch="ngModel" [(ngModel)]="selectedTask.freeSearch" />
      </div>
       <form #topicForm="ngForm" style="margin-top: 20px;">
        <Row>
          <div fxLayout="row" fxLayoutAlign="space-between" fxFlex="100%">
            <mat-form-field fxFlex="50%" appearance="outline" class="form-group">
              <mat-label>From Date</mat-label>
              <input matInput [matDatepicker]="pickerFrom1" name="fromDate" readonly="true" #fromDate="ngModel" [max]="maxDate"
                [(ngModel)]="selectedTask.fromDate" />
              <mat-datepicker-toggle matSuffix [for]="$any(pickerFrom1)">
              </mat-datepicker-toggle>
              <mat-datepicker #pickerFrom1 (closed)="GetTasks()">
              </mat-datepicker>
            </mat-form-field>
            <mat-form-field fxFlex="50%" appearance="outline" class="form-group">
              <mat-label>To Date</mat-label>
              <input matInput [matDatepicker]="pickerFrom" name="toDate" readonly="true" #toDate="ngModel"
                [min]="selectedTask.fromDate" [(ngModel)]="selectedTask.toDate" />
              <mat-datepicker-toggle matSuffix [for]="$any(pickerFrom)">
              </mat-datepicker-toggle>
              <mat-datepicker #pickerFrom (closed)="GetTasks()">
              </mat-datepicker>
            </mat-form-field>
          </div>
        </Row>
        <Row>
          <div fxLayout="row" fxLayoutAlign="space-between" fxFlex="100%">
             <mat-form-field appearance="outline" fxFlex="50%">
              <mat-label>--Please Select Task--</mat-label>
              <mat-select name="id" [(ngModel)]="selectedTask.id" (selectionChange)="GetTasks()">
                <mat-option style="background-color: #eaf3fc">
                    <ngx-mat-select-search (ngModelChange)="TaskAutoCompleteSearch($event)" [(ngModel)]="taskSearchValue"
                            name="taskSearchValue" [noEntriesFoundLabel]="'No Matching Found'" [hideClearSearchButton]=true
                            placeholderLabel="Search Task..." [clearSearchInput]=false>
                    </ngx-mat-select-search>
                </mat-option>
                <mat-option value="0"> --Please Select-- </mat-option>
                <mat-option *ngFor="let val of taskFilterData" [value]="val.id">
                 <b>{{   val.id +' - ' +  val.priority+ ' - ' +  val.sp+' - ' +  val.user}}</b>
                 {{ ' - ' + val.title   }}
                   <hr>
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" fxFlex="50%">
              <mat-label>--Please Select User--</mat-label>
              <mat-select name="UserId" [(ngModel)]="selectedTask.userId" (selectionChange)="GetTasks()">
                  <mat-option style="background-color: #eaf3fc">
                    <ngx-mat-select-search (ngModelChange)="secSvc.UserAutoCompleteSearch($event)" [(ngModel)]="secSvc.userSearchValue"
                            name="secSvc.userSearchValue" [noEntriesFoundLabel]="'No Matching Found'" [hideClearSearchButton]=true
                            placeholderLabel="Search User..." [clearSearchInput]=false>
                    </ngx-mat-select-search>
                </mat-option>
                <mat-option value=""> --Please Select-- </mat-option>
                <mat-option *ngFor="let val of secSvc.userFilterData" [value]="val.id">
                  {{ val.userName }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </Row>
        <div fxLayoutAlign="end end">
          <div>
            <button mat-icon-button mat-sm-button color="primary" cTooltip="Refresh" cTooltipPlacement="top" (click)="Refresh()">
              <mat-icon>autorenew</mat-icon>
            </button>
          </div>
        </div>
      </form>
      <div class="example-container mat-elevation-z8">
        <br />
        <div style="display: inline-block; margin-left: 10px">
          <p style="font-weight: bold; font-size: large; color: rgb(4, 67, 94)">
            {{ this.length }} Number of Rows Appeared
          </p>
        </div>
        <div style="display: inline-block">
          <button mat-icon-button (click)="GetTasks()" matTooltip="Refresh Task">
            <mat-icon>refresh</mat-icon>
          </button>
        </div>
        <c-card style="padding: 10px; margin-top: 10px" class="mat-elevation-z8">
          <c-card-body style="
              padding: 10px;
              background-color: rgb(2, 42, 75);
              margin: 5px;
              border-radius: 10px;
            ">
            <div class="example-table-container">
              <section class="example-container mat-elevation-z8 dataTable" tabindex="0" style="border-radius: 5px">
                <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" style="width: 100%;">
                  <ng-container matColumnDef="id" id="id">
                    <th mat-header-cell *matHeaderCellDef >Task Id</th>
                    <td mat-cell *matCellDef="let tsk"  >{{ tsk.id }}</td>
                  </ng-container>
                  <ng-container matColumnDef="title" id="title" >
                    <th mat-header-cell *matHeaderCellDef style="width: 30%;">
                  Task
                    </th>
                    <td mat-cell *matCellDef="let task" 
                    [ngClass]="{ redText: task.isOverdue,
                    greenText: task.isEarlyFinshed
                  }" 
                 style="width: 30%;" [innerHTML]="taskSvc.getFormattedTask(task)">             
                    </td>
                  </ng-container>
                   <ng-container matColumnDef="activity" >
                    <th mat-header-cell *matHeaderCellDef style="width: 100%;">Activities</th>
                    <td mat-cell *matCellDef="let tsk"><ul style="width: 100%; margin-left: -23px">
                <li *ngFor="let task of tsk.taskActivities">
                  <div>
                    <p   [ngClass]="{ redText: task.isOverdue,
                    greenText: task.isEarlyFinshed
                  }"  [innerHTML]="taskSvc.getFormattedActivitiy(task)"></p>
                  </div>
                </li>
              </ul></td>
                  </ng-container>
                   <ng-container matColumnDef="extraTime" >
                    <th mat-header-cell *matHeaderCellDef style="width: 5%;">
                      Extra Time
                    </th>
                    <td mat-cell *matCellDef="let tsk" style="width: 5%;">
                      {{tsk.totalWorkedTime?(tsk.totalWorkedTime+ '/'+ tsk.sp+'=>' ):""}}  
                      <b>{{ tsk.totalWorkedTime? (tsk.extraTime):'' }}</b>       
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="actions" stickyEnd>
                    <th mat-header-cell *matHeaderCellDef style="text-align: center">
                      Action
                    </th>
                    <td *matCellDef="let row" style="text-align: center; background-color: white">
                      <div>
                        <!-- <mat-icon color="primary" (click)="EditTask(row)">edit</mat-icon> -->
                        <!-- <mat-icon color="warn" (click)="DeleteTask(row.id)"
                          >delete</mat-icon
                        > -->
                      </div>
                    </td>
                  </ng-container>
                  <tr mat-header-row *matHeaderRowDef="displayedColumns ; sticky: true"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                </table>
              </section>
            </div>
          </c-card-body>
        </c-card>
      </div>
    </div>
  </div>
</div>
<div>
  <div *ngIf="isLoading" class="spinnerBox">
    <c-spinner style="height: 100px; width: 100px; color: white"></c-spinner>
  </div>
</div>
