<div class="container-fluid page">
    <div class="d-flex page_box p-3 mt-2  header-sticky" position="sticky">
        <div fxLayout="row" fxLayoutAlign="space-between" fxFlex="100%">
            <div *ngIf="AddMode">Create Appointment
            </div>
            <div *ngIf="EditMode">Update Appointment
            </div>
            <div fxFlex="7%">
                <button mat-icon-button fxLayoutAlign="end end" (click)="dialogref.close()" style="color: white">
                    <mat-icon>close</mat-icon>
                </button>
            </div>
        </div>
    </div>
    <div class="page_content shadow p-3 ">
        <form #appointmentForm="ngForm">
            <Row>
                <div fxLayout="row" fxLayoutAlign="space-between" fxFlex="100%">
                    <mat-form-field [inert]="isReadonly" fxFlex="50%" appearance="outline" class="form-group">
                        <mat-label> Select Doctor</mat-label>
                        <mat-select name="Doctor" matNativeControl #doctorId="ngModel" required
                            [(ngModel)]="selectedAppointment.doctorId">
                            <mat-option>
                                <ngx-mat-select-search (ngModelChange)="DocAutoCompleteSearch($event)"
                                    [(ngModel)]="docSearchValue" name="searchValue"
                                    [noEntriesFoundLabel]="'No Matching Found'" [hideClearSearchButton]=true
                                    placeholderLabel="Search Doctor..." [clearSearchInput]=false>
                                </ngx-mat-select-search>
                            </mat-option>
                            <mat-option [value]="0">
                                --Please Select--</mat-option>
                            <mat-option *ngFor="let doctor of filteredDocData" [value]=" doctor.id"
                                (click)="getTime(doctor.id);getTknNo(doctor.id);minutesGap=doctor.defApptDur">
                                <strong>{{ doctor.doctorName ? (doctor.doctorName + ' ') : '' }}</strong>
                                {{ doctor.contactNo ? ('(ContactNo: ' + doctor.contactNo +') ') : '' }}
                                <!-- {{ doctor.city ? ('(City: ' + doctor.city + ') ') : '' }}
                                {{ doctor.area ? ('(Area: ' + doctor.area + ') ') : '' }}
                                {{ doctor.address ? ('(Address: ' + doctor.address + ') ') : '' }}
                                {{ doctor.houseNo ? ('(House #: ' + doctor.houseNo + ') ') : '' }} -->
                                <hr>
                            </mat-option>
                        </mat-select>
                        <div matSuffix [ngClass]="{disabledDiv:isReadOnly}">
                            <button mat-icon-button style="color:#940540;"
                                (click)="OpenDoctorDialog(); $event.stopPropagation()" cTooltip="Explore Doctor">
                                <mat-icon>add</mat-icon>
                            </button>
                        </div>
                    </mat-form-field>

                    <mat-form-field appearance="outline" fxFlex="100%" class="form-group">
                        <span matPrefix style="margin-left: 10px;">{{ TokenPrefix() }}</span>
                        <mat-label style="margin-left: 15px;">Token No </mat-label>
                        <input min="1" type="number" maxlength="3" [required]="EditMode" style="color: rgb(173, 5, 47);font-weight: bold;"
                            (keypress)="validateNo($event)" matInput class="form-control" name="tokenId"
                            #tokenId="ngModel" [(ngModel)]="selectedAppointment.tokenId" />
                    </mat-form-field>
                </div>
            </Row>
            <Row>
                <div fxLayout="row" fxLayoutAlign="space-between">
                    <mat-form-field appearance="outline" fxFlex="100%" class="form-group">
                        <mat-label>Date </mat-label>
                        <input
                            [min]="utcToLocalDate(selectedAppointment.date)>minAppDate?minAppDate:selectedAppointment.date"
                            [matDatepicker]="picker" matInput class="form-control" name="date" #date="ngModel" readonly
                            [(ngModel)]="selectedAppointment.date" required />
                        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                    <mat-form-field fxFlex="50%" appearance="outline" class="form-group">
                        <mat-label> Select Status</mat-label>
                        <mat-select name="StatusId" matNativeControl #statusId="ngModel" required
                            [(ngModel)]="selectedAppointment.statusId">
                            <mat-option [value]="0">
                                --Please Select--</mat-option>
                            <mat-option *ngFor="let val of appStatus" [value]=" val.id">
                                {{ val.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </Row>
            <Row>
                <div fxFlex="100%">
                    <mat-form-field appearance="outline" style="width: 100%;" class="custom-theme">
                        <mat-label> Select Patient</mat-label>
                        <mat-select name="Patient" matNativeControl #patientId="ngModel" required
                            [(ngModel)]="selectedAppointment.patientId">
                            <mat-option>
                                <ngx-mat-select-search (ngModelChange)="AutoCompleteSearch($event)"
                                    [(ngModel)]="searchValue" name="searchValue"
                                    [noEntriesFoundLabel]="'No Matching Found'" [hideClearSearchButton]=true
                                    placeholderLabel="Search Patient..." [clearSearchInput]=false>
                                </ngx-mat-select-search>
                            </mat-option>
                            <mat-option [value]="0" (click)="selectedAppointment.age='';selectedAppointment.gender=''">
                                --Please Select--</mat-option>
                            <mat-option *ngFor="let patient of filteredData" [value]=" patient.id"
                                (click)="Search(patient)">
                                <strong>{{ patient.patientName ? (patient.patientName + ' ') : '' }}</strong>
                                {{ patient.dateOfBirth ? ('(DOB: ' + (patient.dateOfBirth |date:'yyyy-MM-dd') + ') ') :
                                        '' }}
                                <!--{{ patient.age ? ('(Age: ' + patient.age + ') ') : '' }} -->
                                {{ patient.gender ? ('(Gender: ' + patient.gender + ') ') : '' }}
                                {{ patient.contactNo ? ('(ContactNo: ' + patient.contactNo +') ') : '' }}
                                {{ patient.city ? ('(City: ' + patient.city + ') ') : '' }}
                                {{ patient.area ? ('(Area: ' + patient.area + ') ') : '' }}
                                {{ patient.address ? ('(Address: ' + patient.address + ') ') : '' }}
                                {{ patient.houseNo ? ('(House #: ' + patient.houseNo + ') ') : '' }}
                                <hr>
                            </mat-option>
                        </mat-select>
                        <div matSuffix [ngClass]="{disabledDiv:isReadOnly}">
                            <button mat-icon-button style="color:#940540;"
                                (click)="OpenPatientDialog(); $event.stopPropagation()" cTooltip="Explore Patient">
                                <mat-icon>add</mat-icon>
                            </button>
                        </div>
                    </mat-form-field>
                </div>
            </Row>
            <Row>
                <div fxLayout="row" fxLayoutAlign="space-between">
                    <mat-form-field fxFlex="49%" appearance="outline">
                        <mat-label>Time </mat-label>
                        <input matInput [ngxTimepicker]="min" [min]="minTime" #time="ngModel" name="Time"
                            [(ngModel)]="selectedAppointment.time" required readonly [format]="12" />
                        <ngx-material-timepicker [timepickerClass]="'custome-class'" #min [minutesGap]="minutesGap"></ngx-material-timepicker>
                    </mat-form-field>
                    <mat-form-field fxFlex="49%" appearance="outline">
                        <mat-label>Age </mat-label>
                        <input matInput #age="ngModel" name="age" [(ngModel)]="selectedAppointment.age  " readonly />
                    </mat-form-field>
                    <mat-form-field fxFlex="49%" appearance="outline">
                        <mat-label>Gender </mat-label>
                        <input matInput #gender="ngModel" name="gender" [(ngModel)]="selectedAppointment.gender"
                            readonly />
                    </mat-form-field>
                </div>
            </Row>
            <div fxLayoutAlign="end end">
                <c-spinner *ngIf="proccessing" style="height: 50px;width: 50px;color: rgb(3, 71, 102);"></c-spinner>
                <button  *ngIf="AddMode && !proccessing" [ngClass]="{disabledBtn:isReadOnly}" class="bttn" (click)="SaveAppointment()">Submit</button>
                <button  *ngIf="EditMode && !proccessing" [ngClass]="{disabledBtn:isReadOnly}" class="bttn" (click)="SaveAppointment()">Update</button>
                <div *ngIf="!proccessing">
                    <button mat-icon-button mat-sm-button color="primary" cTooltip="Refresh" cTooltipPlacement="top"
                        (click)="Refresh()">
                        <mat-icon>autorenew</mat-icon>
                    </button>
                </div>
            </div>
        </form>
      </div>
</div>
<div>
    <div *ngIf="isLoading" class="spinnerBox">
        <c-spinner style="height: 100px;width: 100px;color: white;"></c-spinner>
    </div>
</div>
