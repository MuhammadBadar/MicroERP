<div class="container-fluid page">
    <div class="d-flex page_box p-3 mt-2  header-sticky" position="sticky">
        <div> Appointments
        </div>
    </div>
    <div class="page_content shadow p-3 position-relative">
        <div class="pull-right" style="text-align:end; margin-top: 0px;">
            <button [ngClass]="{disabledBtn:isReadOnly}" class="bttn" (click)="OpenDialog()">Create</button>
            <button mat-icon-button mat-sm-button color="primary" cTooltip="Refresh  List" (click)="ngOnInit()">
                <mat-icon>autorenew</mat-icon>
            </button>
        </div>
        <div style="text-align:center;margin-top: 10px; justify-content: center;align-items: center;">
            <mat-form-field [inert]="isDDDReadOnly" appearance="outline" class="form-group" fxFlex="100%">
                <mat-label> Select Doctor</mat-label>
                <mat-select  (selectionChange)="SearchByDates()" name="doctorId" matNativeControl #doctorId="ngModel"
                    required [(ngModel)]="selectedApmnt.doctorId">
                    <mat-option>
                        <ngx-mat-select-search (ngModelChange)="DocAutoCompleteSearch($event)"
                            [(ngModel)]="docSearchValue" name="searchValue" [noEntriesFoundLabel]="'No Matching Found'"
                            [hideClearSearchButton]=true placeholderLabel="Search Doctor..." [clearSearchInput]=false>
                        </ngx-mat-select-search>
                    </mat-option>
                    <mat-option [value]="0">
                        --Please Select--</mat-option>
                    <mat-option *ngFor="let doctor of filteredDocData" [value]=" doctor.id">
                        <strong>{{ doctor.doctorName ? (doctor.doctorName + ' ') : '' }}</strong>
                        {{ doctor.contactNo ? ('(ContactNo: ' + doctor.contactNo +') ') : '' }}
                        {{ doctor.city ? ('(City: ' + doctor.city + ') ') : '' }}
                        {{ doctor.area ? ('(Area: ' + doctor.area + ') ') : '' }}
                        {{ doctor.address ? ('(Address: ' + doctor.address + ') ') : '' }}
                        {{ doctor.houseNo ? ('(House #: ' + doctor.houseNo + ') ') : '' }}
                        <hr>
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <!-- </div> -->
            <!-- <div style="text-align:center; justify-content: center;align-items: center;"> -->
            <mat-form-field appearance="outline" class="custom-theme" fxFlex="50%" s>
                <mat-label> Select Patient</mat-label>
                <mat-select (selectionChange)="SearchByDates()" name="patientId" matNativeControl #patientId="ngModel"
                    [(ngModel)]="selectedApmnt.patientId">
                    <mat-option>
                        <ngx-mat-select-search (ngModelChange)="AutoCompleteSearch($event)" [(ngModel)]="searchValue"
                            name="searchValue" [noEntriesFoundLabel]="'No Matching Found'" [hideClearSearchButton]=true
                            placeholderLabel="Search Patient..." [clearSearchInput]=false>
                        </ngx-mat-select-search>
                    </mat-option>
                    <mat-option [value]="0">
                        --Please Select--</mat-option>
                    <mat-option *ngFor="let patient of filteredData" [value]=" patient.id">
                        <strong>{{ patient.patientName ? (patient.patientName + ' ') : '' }}</strong>
                        {{ patient.dateOfBirth ? ('(DOB: ' + (patient.dateOfBirth |date:'yyyy-MM-dd') +
                        ') ') : '' }}
                        {{ patient.age ? ('(Age: ' + patient.age + ') ') : '' }}
                        {{ patient.gender ? ('(Gender: ' + patient.gender + ') ') : '' }}
                        {{ patient.contactNo ? ('(ContactNo: ' + patient.contactNo +') ') : '' }}
                        {{ patient.city ? ('(City: ' + patient.city + ') ') : '' }}
                        {{ patient.area ? ('(Area: ' + patient.area + ') ') : '' }}
                        {{ patient.address ? ('(Address: ' + patient.address + ') ') : '' }}
                        {{ patient.houseNo ? ('(House #: ' + patient.houseNo + ') ') : '' }}
                        <hr>
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div style="text-align:center;padding-top: 10px;">
            <mat-form-field fxFlex="50%" appearance="outline" class="form-group">
                <mat-label> Select Status</mat-label>
                <mat-select (selectionChange)="SearchByDates()" name="StatusId" matNativeControl #statusId="ngModel"
                    required [(ngModel)]="selectedApmnt.statusId">
                    <mat-option [value]="0">
                        --Please Select--</mat-option>
                    <mat-option *ngFor="let val of appStatus" [value]=" val.id">
                        {{ val.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" class="custom-theme" fxFlex="50%" s>
                <mat-label>From Date</mat-label>
                <input matInput [matDatepicker]="startDateDP" name="from" [(ngModel)]="selectedApmnt.from" readonly
                    [max]="curDate">
                <mat-datepicker-toggle matSuffix [for]="startDateDP"></mat-datepicker-toggle>
                <mat-datepicker #startDateDP (closed)="SearchByDates()"></mat-datepicker>
            </mat-form-field>
            <!-- <mat-form-field style="margin-left:10px"> -->
            <mat-form-field appearance="outline" class="custom-theme" fxFlex="50%" s>
                <mat-label>To Date</mat-label>
                <input matInput [matDatepicker]="endDateDP" [min]="selectedApmnt.from" name="to" readonly
                    [(ngModel)]="selectedApmnt.to">
                <mat-datepicker-toggle matSuffix [for]="endDateDP"></mat-datepicker-toggle>
                <mat-datepicker #endDateDP (closed)="SearchByDates()"></mat-datepicker>
            </mat-form-field>
            <!-- <button mat-icon-button cTooltip="Get record  in Date Range" (click)="onBlur()">
                                                <mat-icon>search</mat-icon>
                                            </button> -->
        </div>
        <section class=" example-container mat-elevation-z8" tabindex="0" style="border-radius: 5px;margin-top: 20px;">
            <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort>
                <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> TokenNo </th>
                    <td mat-cell *matCellDef="let element"> {{element.tokenNo}} </td>
                </ng-container>
                <ng-container matColumnDef="patientname">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> PatientName </th>
                    <td mat-cell *matCellDef="let element"> {{element.patientName}} </td>
                </ng-container>
                <ng-container matColumnDef="doctor">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Doctor </th>
                    <td mat-cell *matCellDef="let element"> {{element.doctor}} </td>
                </ng-container>
                <ng-container matColumnDef="date">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Date </th>
                    <td mat-cell *matCellDef="let element"> {{element.date| date:"dd/MM/yyyy"}} </td>
                </ng-container>
                <ng-container matColumnDef="time">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Time </th>
                    <td mat-cell *matCellDef="let element"> {{element.time}} </td>
                </ng-container>
                <ng-container style="display: none;" matColumnDef="ageTooltip">
                    <th mat-header-cell style="display: none;" *matHeaderCellDef mat-sort-header> Age Tooltip </th>
                    <td style="display: none;" mat-cell *matCellDef="let element"> {{element.ageTooltip}} </td>
                </ng-container>
                <ng-container matColumnDef="age">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Age </th>
                    <td mat-cell [matTooltip]="element['age']" matTooltipPosition="above" *matCellDef="let element">
                        {{ element.shortAge }}
                    </td>
                </ng-container>
                <ng-container matColumnDef="gender">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Gender </th>
                    <td mat-cell *matCellDef="let element"> {{element.gender}} </td>
                </ng-container>
                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef> Status </th>
                    <td mat-cell *matCellDef="let element"> {{element.status}} </td>
                </ng-container>
                <ng-container matColumnDef="isActive">
                    <th mat-header-cell *matHeaderCellDef> IsActive </th>
                    <td mat-cell *matCellDef="let element"> {{element.isActive?"Yes":"No"}} </td>
                </ng-container>
                <ng-container matColumnDef="actions" stickyEnd="true">
                    <th mat-header-cell *matHeaderCellDef>
                        <p style="font-size: 14px;text-align: center;">Action</p>
                    </th>
                    <td mat-cell *matCellDef="let row">
                        <div style="text-align: center;" [ngClass]="{disabledDiv:isReadOnly}">
                            <button mat-icon-button mat-sm-button (click)="EditAppointment(row)"
                                style=" color:#1e293b ; " cTooltip=" EditPatient">
                                <mat-icon>edit</mat-icon>
                            </button>

                        </div>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
        </section>
    </div>
</div>
<div>
    <div *ngIf="isLoading" class="spinnerBox">
        <c-spinner style="height: 100px;width: 100px;color: white;"></c-spinner>
    </div>
</div>
