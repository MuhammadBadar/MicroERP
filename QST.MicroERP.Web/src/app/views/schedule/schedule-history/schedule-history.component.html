<div class="container-fluid page">
  <div class="d-flex page_box p-3 mt-2 header-sticky" position="sticky">
    <div fxLayout="row" fxLayoutAlign="space-between" fxFlex="100%">
      <div>{{ user }} Schedule History</div>
      <div fxFlex="7%">
        <button
          mat-icon-button
          fxLayoutAlign="end end"
          (click)="dialogRef.close()"
          style="color: white"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
  </div>
  <div class="page_content shadow p-3 position-relative">
    <div style="margin-top: 20px">
      <button
        mat-fab
        extended
        style="background-color: #4e4c4c; color: white; margin: 5px"
        (click)="dialogRef.close()"
      >
        <mat-icon>arrow_back</mat-icon>
        Back
      </button>
    </div>
    <div fxLayout="column">
      <!-- <p style="text-align: center;align-items: center;justify-content: center;font-size: 25px;">
                <strong>Schedule Name:</strong> {{selectedSchedule.ScheduleName}}
            </p>
            <hr>
            <div fxLayout="row" fxLayoutAlign="space-between" fxFlex="100%">
                <p fxFlex="50%"><strong>Age:</strong> {{selectedSchedule.age}}</p>
                <p fxFlex="50%" style="text-align:end;"><strong>Contact No:</strong> {{selectedSchedule.contactNo}}</p>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between" fxFlex="100%">
                <p fxFlex="50%" *ngIf="selectedSchedule.city"><strong>City:</strong> {{selectedSchedule.city}}</p>
                <p fxFlex="50%" *ngIf="selectedSchedule.area" style="text-align:end;"><strong>Area:</strong>
                    {{selectedSchedule.area}}</p>
            </div> -->
      <hr />
      <!-- <form #userForm="ngForm">
            <div style="text-align:center;padding-top: 70px;">
                <mat-form-field>
                    <mat-label>From Date</mat-label>
                    <input required matInput [matDatepicker]="startDateDP" name="from" [(ngModel)]="selectedRx.from" readonly
                        [max]="curDate">
                    <mat-datepicker-toggle matSuffix [for]="startDateDP"></mat-datepicker-toggle>
                    <mat-datepicker #startDateDP></mat-datepicker>
                </mat-form-field>
                <mat-form-field style="margin-left:10px">
                    <mat-label>To Date</mat-label>
                    <input required matInput [matDatepicker]="endDateDP" [min]="selectedRx.from" name="to" readonly
                        [(ngModel)]="selectedRx.to">
                    <mat-datepicker-toggle matSuffix [for]="endDateDP"></mat-datepicker-toggle>
                    <mat-datepicker #endDateDP></mat-datepicker>
                </mat-form-field>
                <button [disabled]="userForm.invalid" type="submit"  mat-icon-button cTooltip="Get record  in Date Range" (click)="onBlur()">
                    <mat-icon>search</mat-icon>
                </button>
                <button mat-icon-button mat-sm-button color="primary" cTooltip="Refresh  List" (click)="ngOnInit()">
                    <mat-icon>autorenew</mat-icon>
                </button>
            </div>
            </form> -->
      <div fxLayout="row">
        <p>Total Schedules(s) : &nbsp;</p>
        <b>{{ schedules.length > 0 ? schedules.length : 0 }}</b>
      </div>
      <c-card
        style="padding: 10px; margin-top: 30px"
        class="mat-elevation-z8"
        *ngIf="schedules.length > 0"
      >
        <c-card-body
          style="
            padding: 10px;
            background-image: linear-gradient(
              to bottom,
              rgb(2, 33, 58),
              rgb(7, 95, 122)
            );
            margin: 5px;
            border-radius: 10px;
          "
        >
          <div class="example-table-container">
            <section
              class="example-container mat-elevation-z8"
              tabindex="0"
              style="border-radius: 5px"
            >
              <table
                mat-table
                [dataSource]="dataSource"
                multiTemplateDataRows
                class="mat-elevation-z8"
              >
                <ng-container matColumnDef="expand" sticky="true">
                  <th
                    mat-header-cell
                    *matHeaderCellDef
                    aria-label="row actions"
                  >
                    <div style="width: 50px">&nbsp;</div>
                  </th>
                  <td mat-cell *matCellDef="let element" style="width: 50px">
                    <div *ngIf="element.scheduleDays.length > 0">
                      <button
                        mat-icon-button
                        aria-label="expand row"
                        (click)="
                          expandedElement =
                            expandedElement === element ? null : element;
                          $event.stopPropagation();
                          highlight(element)
                        "
                      >
                        <mat-icon *ngIf="expandedElement !== element"
                          >keyboard_arrow_down
                        </mat-icon>
                        <mat-icon *ngIf="expandedElement === element"
                          >keyboard_arrow_up
                        </mat-icon>
                      </button>
                    </div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="Id">
                  <th mat-header-cell *matHeaderCellDef>Sr No</th>
                  <td mat-cell *matCellDef="let element">{{ element.id }}</td>
                </ng-container>
                <ng-container matColumnDef="schType">
                  <th mat-header-cell *matHeaderCellDef>
                    <div style="min-width: 100px">Schedule Type</div>
                  </th>
                  <td mat-cell *matCellDef="let element">
                    <div style="min-width: 100px">
                      {{ element.scheduleType }}
                    </div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="isActive">
                  <th mat-header-cell *matHeaderCellDef>
                    <div style="min-width: 50px; font-size: 14px">IsActive</div>
                  </th>
                  <td mat-cell *matCellDef="let element">
                    <div style="min-width: 50px">
                      {{ element.isActive ? "Yes" : "No" }}
                    </div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="Action" stickyEnd="true">
                  <th
                    mat-header-cell
                    *matHeaderCellDef
                    style="
                      min-width: 150px;
                      text-align: center;
                      margin-left: 0;
                      margin-right: 0;
                    "
                  >
                    <div style="font-size: 14px">Action</div>
                  </th>
                  <td
                    mat-cell
                    *matCellDef="let row"
                    style="
                      min-width: 150px;
                      text-align: center;
                      margin-left: 0;
                      margin-right: 0;
                    "
                  >
                    <div>
                      <!-- <mat-icon (click)="EditPrescription(row)" matTooltip="Edit"
                                                style="cursor: pointer;">edit</mat-icon> -->
                      <mat-icon
                        mat-icon-button
                        mat-sm-button
                        style="color: rgb(86, 3, 3)"
                        matTooltip="View"
                        >visibility</mat-icon
                      >
                    </div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="expandedDetail">
                  <td
                    mat-cell
                    *matCellDef="let element"
                    [attr.colspan]="columnsToDisplayWithExpand.length"
                  >
                    <div
                      class="example-element-detail"
                      *ngIf="element.scheduleDays.length > 0"
                      style="align-items: center; border-radius: 30px"
                      [@detailExpand]="
                        element == expandedElement ? 'expanded' : 'collapsed'
                      "
                    >
                      <div *ngIf="expandedElement">
                        <section
                          class="example-container mat-elevation-z8"
                          tabindex="0"
                          style="margin: 70px; border-radius: 30px; width: 100%"
                        >
                          <h3>Schedules Days & Events</h3>
                          <table
                            #innerTables
                            mat-table
                            [dataSource]="element.scheduleDays"
                            class="mat-elevation-z8"
                            style="overflow: auto"
                          >
                            <ng-container matColumnDef="day">
                              <th mat-header-cell *matHeaderCellDef>
                                <div style="min-width: 150px">Days</div>
                              </th>
                              <td mat-cell *matCellDef="let element">
                                <div style="min-width: 150px">
                                  {{ element.day }}
                                </div>
                              </td>
                            </ng-container>
                            <ng-container matColumnDef="scheduleDayEvents">
                              <th mat-header-cell *matHeaderCellDef>
                                <div style="min-width: 450px">
                                  Schedule Day Event(s)
                                </div>
                              </th>
                              <td mat-cell *matCellDef="let element">
                                <div style="min-width: 450px">
                                  {{ element.schDayEvents }}
                                </div>
                              </td>
                            </ng-container>
                              <ng-container matColumnDef="workTime">
                  <th mat-header-cell *matHeaderCellDef>WorkTime</th>
                  <td mat-cell *matCellDef="let element">{{ element.workTime }}</td>
                </ng-container>
                            <tr
                              mat-header-row
                              *matHeaderRowDef="innerDisplayedColumns"
                            ></tr>
                            <tr
                              mat-row
                              *matRowDef="
                                let row;
                                columns: innerDisplayedColumns
                              "
                            ></tr>
                          </table>
                        </section>
                      </div>
                    </div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="header-row-first-group">
                  <th mat-header-cell *matHeaderCellDef [attr.colspan]="8">
                    <div style="width: 100%">.</div>
                  </th>
                </ng-container>
                <ng-container
                  matColumnDef="header-row-second-group"
                  stickyEnd="true"
                >
                  <th
                    mat-header-cell
                    *matHeaderCellDef
                    style="text-align: center"
                    [attr.colspan]="3"
                  >
                    <div style="width: 100%">Actions</div>
                  </th>
                </ng-container>
                <tr
                  mat-header-row
                  *matHeaderRowDef="columnsToDisplayWithExpand"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="let element; columns: columnsToDisplayWithExpand"
                  class="example-element-row"
                  [class.example-expanded-row]="expandedElement === element"
                  [ngClass]="{ highlight: selectedRowIndex == element.id }"
                  (click)="highlight(element)"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: ['expandedDetail']"
                  class="example-detail-row"
                ></tr>
              </table>
            </section>
          </div>
        </c-card-body>
      </c-card>
      <div *ngIf="schedules.length == 0">
        <hr />
        <p
          style="
            margin-top: 20px;
            text-align: center;
            align-items: center;
            justify-content: center;
            font-size: 25px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: bold;
          "
        >
          Schedule has no History
        </p>
      </div>
    </div>
  </div>
</div>
